---
title: "Comparison of statistical methods for the detection of differentially methylated regions."
author: "Hana Parizkova & Deepak Tanwar"
date: "<b>Created on:</b> 2018-12-21 <br> <b>Updated on:</b> `r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    highlight: pyg
    keep_md: no
    number_sections: no
    fig_width: 8.5
    fig_height: 11
    fig_caption: true
    df_print: paged
    code_folding: show
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
  fontsize: 12pt
  geometry: margin=1in
  documentclass: article
---

```{r, warning=F, message=FALSE, echo=FALSE}
```


# Introduction
## DNA methylation

DNA methylation (DNAme) is a process by which methyl groups are added to the DNA molecule. Methylation could change the activity of the DNA without changing it's code. It serves as a critical phenomenon to several biological functions and has a role in certain disease states. Further, DNAme is a privileged candidate for epigenetic inheritance due to its plasticity and stability across mitosis and meiosis. It is one of the major mechanisms of epigenetic modification and has a fundamental influence on gene expression, genomic stability and cellular activity [ ].

With the advancement of next-generation (NGS) sequencing techniques, there are several methods for studying DNA methylation, but, few offer a better resolution of methylation status such as bisulfite sequencing (also known as Bisulfite-Seq, BS-Seq, Methyl-Seq or WGBS). The key idea of the method is combining the power of high-throughput DNA sequencing with the treatment of DNA with sodium bisulfite. The human methylome contains around 28 million CG sites in humans. There are also non-CG methylated sites: CHG or CHH, where H represents adenine, thymine, or cytosine.


## Whole Genome Bisulphite Sequencing

Whole Genome Bisulphite Sequencing (WGBS) is a gold standard NGS technique for studying DNAme in the genome of mammals. WGBS combines sodium bisulfite conversion of the DNA sequence with high throughput DNA sequencing. The sodium bisulfite reaction converts the unmethylated cytosines (C) to uracils (U), whereas, methylated C remains unchanged. These U are further converted to thymine (T) after the polymerase chain reaction (PCR). Although, no change occurs for methylated C. Methylcytosines are the methylated versions of the cytosine bases. This is done by transferring a methyl group onto the C5 position of the cytosine.

The aim of NGS-based DNA methylation analysis is to investigate genomic DNA and find out whether single cytosines or entire regions in the genome are methylated or not. WGBS is the most comprehensive sequencing for DNA methylation profiling, allowing single-base resolution of 5-mC within the whole genome. By comparing treated and untreated sequences, the location of the methylated cytosines is determined.


There are several applications of WGBS, including (not limited to):
- detection of differentially methylated regions (DMRs)
- detection of differentially methylated loci (DMLs)
- detection of copy number variations (CNVs)
- detection of single nucleotide polymorphisms (SNPs)
- detection of cytosine methylation levels of transcription factor binding sites (TFBSs)
- detecting methylation level or distribution (globally, single nucleotide, chromosome-wide and gene-centric)

Sequencing the whole genome is generally quite expensive. Therefore, although it has been applied to large genomes such as the human genome, large numbers of individual samples are seldom sequenced. Reduced representation bisulfite sequencing (RRBS) has been developed for this reason, in which the bisulfite reaction occurs but the sequencing is limited to around 1% of the genome. This enables the sequencing of the genome of several individuals.


## Basic pipeline for WGBS data analysis:



## Limitations of current methods
- Methods are greatly hindered by low sample size. Most of the methods depend on large sample sizes.
The number of tests performed = the number of loci analyzed. Example: Human genome has ~30 million CpGs [1].
Measurements are spatially correlated across the genome [2], but in most methods measurements from all loci are treated independently.
- Multiple testing corrections without considering the spatial correlation can result in a loss of power.
DMRs more biologically relevant than DMLs.
DML approaches may construct DMRs by chaining together neighboring significant loci, but this type of approach will not yield a proper assessment of the statistical significance of the constructed regions, nor will the FDR be properly controlled [4]. Controlling the FDR at the level of individual loci is not the same as controlling FDR of regions.
- Methylation data cannot be modeled either by Gaussian models (due to low coverage) or by Binomial models (do not account for biological variability). Beta-Binomial models are computationally difficult.

## Challenges for assessing DMRs:
- defining region boundaries
- methods ignore correlation across loci
- biological variability from sample to sample
- should be powerful even in the case of 2 samples per group.


# Methods
## Data
Two data sets were used.

One, representing negative control (with no expected DMRs), contained six methylation profiling samples from normal human dendritic cells ([data in GEO](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE64177)). The samples were artificially divided into two groups of three samples, group 1 consisting of samples [GSM1565940](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565940), [GSM1565944](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565944), and [GSM1565948](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565948), group 2 consisting of samples [GSM1565942](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565942), [GSM1565946](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565946), and [GSM1565950](https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM1565950). To obtain reasonable running times, only methylation data from chromosome 18 were used.

The second set of data was created from the negative control by adding 100 simulated DMRs using `simDMRS` function from R package `dmrseq`. 

The reported DMRs were (if possible) filtered for only those that contain at least 10 CpGs and the mean difference between the two groups is at least 0.1 (the simulated regions had effect sizes between 0.163 and 0.450).

[Data download and filtering](https://github.com/sta426hs2018/sta426-project-dmr-comparison/blob/master/data/data_download_and_filter.html)

## The methods used for comparison
In total 7 different methods were used for the comparison. Their main features are summarized in the following table:

| Method     | Preprocessing + statistical test used                                                   | p-value estimate given | CpG / non CpG | Implementation language | DOI                           | Availability                                                                                         |
|------------|-----------------------------------------------------------------------------------------|------------------------|---------------|-------------------------|-------------------------------|------------------------------------------------------------------------------------------------------|
| bsseq      | local-likelihood smoothing, t-test similar statistics                                   | no                     | CpG only      | R                       | 10.1186/gb-2012-13-10-r83     | [Bioconductor package bsseq](https://bioconductor.org/packages/release/bioc/html/bsseq.html)         |
| CGmapTools | unpaired t-test                                                                         | yes                    | CpG only      | C, C++, Python          | 10.1093/bioinformatics/btx595 | [binary package](https://cgmaptools.github.io/)                                                      |
| defiant    | Weighted Welch Expansion                                                                | yes                    | CpG only      | Shell                   | 10.1186/s12859-018-2037-1     | [binary package](https://github.com/hhg7/defiant)                                                    |
| DMRcaller  | no preprocessing, or pooling in bins, or kernel smoothing; Fisher's exact or Score test | yes                    | all contexts  | R                       | 10.1093/nar/gky602            | [Bioconductor package DMRcaller](https://bioconductor.org/packages/release/bioc/html/DMRcaller.html) |
| dmrseq     | smoothing; generalized least squares                                                    | yes                    | CpG only      | R                       | 10.1093/biostatistics/kxy007  | [Bioconductor package dmrseq](https://bioconductor.org/packages/release/bioc/html/dmrseq.html)       |
| methPipe   | Fisher's exact test                                                                     | no                     | CpG only      | C, C++                  | 10.1371/journal.pone.0081148  | [binary package](http://smithlabresearch.org/software/methpipe/)                                     |
| methylKit  | Fisher's exact test, or logistic regression with tiling                                 | yes                    | all contexts  | R                       | 10.1186/gb-2012-13-10-r87     | [Bioconductor package methylKit](https://bioconductor.org/packages/release/bioc/html/methylKit.html) |

### `bsseq` analysis
link to bsseq

### `CGmapTools` analysis
link to CGmapTools

### `defiant` analysis
link to defiant

### `DMRcaller` analysis
link to DMRcaller

### `dmrseq` analysis
link to dmrseq

### `methPipe` analysis
link to methPipe

### `methylKit` analysis
link to methylKit


# Results and discussion

## Diagnostic plots
Distribution of the coverage and beta values of all the samples, shown in figure . and figure ...., depicts that there is not much difference between individual samples. Also, the PCA plot, figure ..., shows no clustering of the two artificially created groups.

More diagnostic plots can be found  [here](../exp/20181221-plot_results-03/20190108-03_coverage_plots/coverage_plots.html).

## DMRs identified by the methods
There was no single region that would all methods overlap by at least 1bp. 

Figure . shows one simulated DMR, generated as described in the Data section. This region has the highest delta (methylation difference) value in the list of all generated DMRs (0.447). This region was identified as DMR by 6 methods (not identified by methpipe; also not identified by DMRcaller bins method). 

Similar plots for all 100 simulated DMRS are shown in [this report](../exp/20181221-plot_results-03/20181230-02_regions_plot/regions_plot.html#5_regions_plot_simulated_data). 

## Comparison of different methods
We considered any overlap between the simulated and identified DMRs to be sufficient for the region to be classified as true positive.Details of computing true positives and false positives are described in [this report](../exp/20181221-plot_results-03/20190108-04_comparison_plots/comparison_plots.html#422_ways_of_computing_tps_and_fps).

###Negative Control
As per negative control, we do not expect any true DMRs, all the identified regions are thus false positives. dmrseq and defiant methods did not find any DMRs in the negative control data, whereas others did, as shown in figure..


### Simulated Data
Figure ... shows that dmrseq performs better than the other methods. On x axis is the observed FDR, on y axis the power, both for different specified FDR cut-offs. The computation of FDR and power is described [here](../exp/20181221-plot_results-03/20190108-04_comparison_plots/comparison_plots.html#422_ways_of_computing_tps_and_fps).

We have also checked how well the methods control FDR (figure ...). For this, we plotted the observed FDR (the proportion of false discoveries) and the specified FDR (cutoff after multiple testing correction by BH). We can see that dmrseq again outperforms the other methods.
 BSseq and methpipe do not allow user control of FDR, and are thus not depicted in the figure. 

# Conclusion
In this project, we wanted to compare the methods for identification of DMRs, which were not compared in the dmrseq paper (ref). We used nearly all methods available, except the ones which do not have a proper statistical description or have not been updated for a long time. We found that dmrseq outperforms all the methods that we compared. This is especially important when we take into acccount that we used just 3 samples per group, which is the most one can hope for in the real experiments (due to the high cost of WGBS). But, it has to be mentioned that the simulated DMRs we used for the comparison were created using a function which is a part of the dmrseq method. It would be nice to repeat the experiment on some independently generated data.

All the methods were well documented and were easy to use for a non-experienced user, except for CGmapTools, where the documentation was not clear. 

# SessionInfo

```{r}
devtools::session_info()
```
