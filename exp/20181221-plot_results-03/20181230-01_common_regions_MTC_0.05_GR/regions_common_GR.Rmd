---
title: "Common regions passing MTC"
author: "Deepak Tanwar & Hana Parizkova"
date: "<b>Created on:</b> 2018-12-30 <br> <b>Updated on:</b> `r Sys.Date()`"
output:
  html_document:
    theme: spacelab
    highlight: pyg
    keep_md: no
    number_sections: yes
    fig_width: 8.5
    fig_height: 11
    fig_caption: true
    df_print: paged
    code_folding: show
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
  fontsize: 12pt
  geometry: margin=1in
  documentclass: article
---

# Packages required
```{r, warning=F, message=FALSE}
library(GenomicRanges)
```

# Input files

## Simulated 100 DMRs
```{r}
read.dmr <- GRanges(read.delim("./input/simulated_DMRS.txt.gz", sep = "\t", stringsAsFactors = F, header = T))
```


## DMR files (simulated data)

```{r}
files.sim <- list.files(path = "./input", pattern = "sim_", full.names = T)
names(files.sim) <- sapply(files.sim, function(x) strsplit(x, "\\.|/")[[1]][4])

read.sim <- lapply(files.sim, function(x) GRanges(read.delim(x, sep = "\t", stringsAsFactors = F, header = T)))
```



# Merge GRanges

## Function
```{r}
meta_GR <- function(gr1, gr2, n1 = NULL, n2 = NULL){
  ranges <- subsetByOverlaps(gr1, gr2)
                             # , minoverlap = 1)
  revRanges <- subsetByOverlaps(gr2, gr1)
  hits <- findOverlaps(gr1, gr2)
  idx <- unique(subjectHits(hits))
  values <- DataFrame(rsid=gr2[idx])
  colnames(values) <- c("GRanges", gsub("rsid", "test", colnames(values)[2:ncol(values)]))
  mcols(ranges) <- c(mcols(ranges), values)
  return(ranges)
}

# reduce(gr1, min.gapwidth = 150)


meta_GR(gr1 = read.dmr, gr2 = read.sim$dmrseq_dmr_sim_data)
```



# SessionInfo

```{r}
devtools::session_info()
```